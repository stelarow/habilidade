<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Teste API Supabase</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Teste Direto da API Supabase</h1>
    <p>Slug: editor-materiais-sketchup-realismo-enscape</p>
    
    <button onclick="testAPI()">Testar API</button>
    
    <h2>Resultado:</h2>
    <pre id="result" style="background: #f4f4f4; padding: 10px; overflow: auto; max-height: 600px;"></pre>
    
    <script>
        // Configuração do Supabase
        const supabaseUrl = 'https://vfpdyllwquaturpcifpl.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0';
        
        const { createClient } = supabase;
        const supabaseClient = createClient(supabaseUrl, supabaseAnonKey);
        
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = 'Carregando...';
            
            try {
                // Buscar o post diretamente
                const { data, error } = await supabaseClient
                    .from('blog_posts')
                    .select('*')
                    .eq('slug', 'editor-materiais-sketchup-realismo-enscape')
                    .single();
                
                if (error) {
                    resultDiv.textContent = 'Erro: ' + JSON.stringify(error, null, 2);
                    return;
                }
                
                // Mostrar apenas os primeiros 2000 caracteres do conteúdo
                const result = {
                    ...data,
                    content: data.content.substring(0, 2000) + '...'
                };
                
                resultDiv.textContent = JSON.stringify(result, null, 2);
                
                // Verificar especificamente o início do conteúdo
                console.log('Início do conteúdo:', data.content.substring(0, 500));
                
                // Verificar se contém os metadados problemáticos
                if (data.content.includes('**Publicado em:**')) {
                    alert('⚠️ O conteúdo AINDA contém os metadados antigos!');
                } else if (data.content.includes('*Por: Equipe Escola Habilidade*')) {
                    alert('✅ O conteúdo está no formato CORRETO!');
                } else {
                    alert('❓ Formato do conteúdo não identificado');
                }
                
            } catch (err) {
                resultDiv.textContent = 'Erro JavaScript: ' + err.message;
            }
        }
        
        // Testar automaticamente ao carregar
        window.onload = testAPI;
    </script>
</body>
</html>