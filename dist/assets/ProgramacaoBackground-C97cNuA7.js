import{r as c,R as z,j as T}from"./index-DdBGh_od.js";class L{constructor(){this.activeAnimations=new Set,this.eventListeners=new Map,this.canvasContexts=new Set,this.timers=new Set,this.isTabActive=!0,this.memoryThreshold=100*1024*1024,this.setupVisibilityAPI(),this.setupMemoryMonitoring()}setupVisibilityAPI(){const e=()=>{this.isTabActive=!document.hidden,this.isTabActive?(this.resumeAllAnimations(),console.log("[MemoryManager] Tab active - animations resumed")):(this.pauseAllAnimations(),console.log("[MemoryManager] Tab inactive - animations paused"))};document.addEventListener("visibilitychange",e),this.eventListeners.set("document:visibilitychange",e)}setupMemoryMonitoring(){if(!("memory"in performance))return;const i=setInterval(()=>{const r=performance.memory.usedJSHeapSize/1024/1024;r>150&&(console.warn(`[MemoryManager] High memory usage: ${r.toFixed(1)}MB`),this.emergencyCleanup())},3e4);this.timers.add(i)}registerAnimation(e,i,l,r){const u={id:e,pauseFn:i||(()=>{}),resumeFn:l||(()=>{}),cleanupFn:r||(()=>{}),isPaused:!1};return this.activeAnimations.add(u),u}pauseAllAnimations(){this.activeAnimations.forEach(e=>{e.isPaused||(e.pauseFn(),e.isPaused=!0)})}resumeAllAnimations(){this.isTabActive&&this.activeAnimations.forEach(e=>{e.isPaused&&(e.resumeFn(),e.isPaused=!1)})}unregisterAnimation(e){e&&e.cleanupFn&&e.cleanupFn(),this.activeAnimations.delete(e)}registerEventListener(e,i,l,r){const u=`${e.constructor.name}:${i}`;e.addEventListener(i,l,r),this.eventListeners.has(u)||this.eventListeners.set(u,[]),this.eventListeners.get(u).push({element:e,handler:l,options:r})}registerCanvasContext(e){this.canvasContexts.add(e)}emergencyCleanup(){console.log("[MemoryManager] Emergency cleanup triggered"),this.pauseAllAnimations(),window.gc&&window.gc(),this.canvasContexts.forEach(e=>{e&&e.canvas&&e.clearRect(0,0,e.canvas.width,e.canvas.height)}),setTimeout(()=>{this.isTabActive&&(this.resumeAllAnimations(),console.log("[MemoryManager] Animations resumed after cleanup"))},2e3)}destroy(){this.activeAnimations.forEach(e=>{this.unregisterAnimation(e)}),this.activeAnimations.clear(),this.eventListeners.forEach((e,i)=>{e.forEach(({element:l,handler:r,options:u})=>{l.removeEventListener(i.split(":")[1],r,u)})}),this.eventListeners.clear(),this.timers.forEach(e=>{clearInterval(e)}),this.timers.clear(),this.canvasContexts.clear()}getStats(){const e="memory"in performance?{used:Math.round(performance.memory.usedJSHeapSize/1024/1024),total:Math.round(performance.memory.totalJSHeapSize/1024/1024),limit:Math.round(performance.memory.jsHeapSizeLimit/1024/1024)}:{used:"N/A",total:"N/A",limit:"N/A"};return{activeAnimations:this.activeAnimations.size,eventListeners:this.eventListeners.size,canvasContexts:this.canvasContexts.size,timers:this.timers.size,isTabActive:this.isTabActive,memory:e}}}const C=new L,D=(h,e=[])=>{const i=c.useRef(null);c.useRef(null);const l=c.useRef(null),r=c.useRef(!1),u=c.useCallback(()=>{i.current&&(cancelAnimationFrame(i.current),i.current=null),r.current=!0},[]),g=c.useCallback(d=>{if(!r.current||!d)return;r.current=!1;const f=()=>{r.current||(d(),i.current=requestAnimationFrame(f))};i.current=requestAnimationFrame(f)},[]),n=c.useCallback(d=>{if(!d)return;i.current&&cancelAnimationFrame(i.current),r.current=!1;const f=()=>{r.current||(d(),i.current=requestAnimationFrame(f))};i.current=requestAnimationFrame(f),l.current||(l.current=C.registerAnimation(`${h}-${Date.now()}`,u,()=>g(d),()=>{i.current&&(cancelAnimationFrame(i.current),i.current=null)}))},[h,u,g]),v=c.useCallback(()=>{i.current&&(cancelAnimationFrame(i.current),i.current=null),l.current&&(C.unregisterAnimation(l.current),l.current=null),r.current=!0},[]);return c.useEffect(()=>()=>{v()},[v]),c.useEffect(()=>{},e),{startAnimation:n,stopAnimation:v,pauseAnimation:u,resumeAnimation:g,isAnimating:!r.current&&!!i.current,isPaused:r.current}},I=({performanceConfig:h,deviceCapabilities:e,courseSlug:i})=>{const l=c.useRef(null);c.useRef(null);const r=c.useRef([]);c.useRef({lines:[],cursor:0});const{startAnimation:u,stopAnimation:g}=D(`programacao-background-${i}`,[h]),n=c.useMemo(()=>({snippetCount:Math.min(h?.particleCount||10,4),codeSpeed:h?.staticFallback?0:.6,terminalSpeed:h?.staticFallback?0:120,terminalLines:3,colors:{primary:"#2ED573",secondary:"#1E90FF",accent:"#70A1FF",code:"#2ED573",terminal:"#1E90FF",cursor:"#70A1FF",comment:"#2ED57360",background:"#0A0A0A"},codeSnippets:["function createApp() {","  const app = express();","  return app;","}","","const users = await User.find();","console.log(users.length);","","if (user.isActive) {","  user.lastLogin = new Date();","  await user.save();","}","","export default function App() {","  const [data, setData] = useState();","  return <div>{data}</div>;","}","","class Database {","  constructor(config) {","    this.config = config;","  }","","  async connect() {","    return this.client.connect();","  }","}","","// API Route Handler",'app.get("/api/users", async (req, res) => {',"  try {","    const users = await getUsersFromDB();","    res.json(users);","  } catch (error) {","    res.status(500).json({ error });","  }","});"],terminalCommands:["$ npm install react","$ git add .",'$ git commit -m "feat: add new feature"',"$ npm run build","$ docker build -t app .","$ kubectl apply -f deployment.yaml","$ node server.js"]}),[h]);class v{constructor(s){this.canvas=s,this.lines=[],this.x=Math.random()*(s.width+200)-100,this.y=Math.random()*s.height,this.vx=-n.codeSpeed*(.5+Math.random()*.5),this.vy=(Math.random()-.5)*.5,this.opacity=.2+Math.random()*.3,this.fontSize=12+Math.random()*3,this.lineHeight=this.fontSize+4,this.maxWidth=200+Math.random()*150;const o=Math.floor(Math.random()*(n.codeSnippets.length-8));this.lines=n.codeSnippets.slice(o,o+4+Math.floor(Math.random()*4)),this.typingProgress=0,this.typingSpeed=.5+Math.random()*1,this.fullyTyped=!1}update(){n.codeSpeed!==0&&(this.x+=this.vx,this.y+=this.vy,this.fullyTyped||(this.typingProgress+=this.typingSpeed,this.typingProgress>=this.getTotalCharacters()&&(this.fullyTyped=!0)),this.x<-this.maxWidth-50&&(this.x=this.canvas.width+50,this.y=Math.random()*this.canvas.height,this.typingProgress=0,this.fullyTyped=!1))}getTotalCharacters(){return this.lines.join("").length}draw(s){s.save(),s.globalAlpha=this.opacity,s.font=`${this.fontSize}px 'Courier New', monospace`;let o=0;this.lines.forEach((a,A)=>{const M=this.y+A*this.lineHeight;let p=0;if(this.fullyTyped)p=a.length;else{const y=Math.max(0,this.typingProgress-o);p=Math.min(a.length,y)}const b=a.substring(0,p);if(a.startsWith("//")||a.startsWith("/*")?s.fillStyle=n.colors.comment:a.includes("function")||a.includes("class")||a.includes("const")||a.includes("let")?s.fillStyle=n.colors.primary:a.includes("await")||a.includes("async")||a.includes("return")?s.fillStyle=n.colors.secondary:s.fillStyle=n.colors.code,s.fillText(b,this.x,M),!this.fullyTyped&&o<=this.typingProgress&&this.typingProgress<o+a.length){const y=this.x+s.measureText(b).width,w=Math.sin(Date.now()*.008)*.5+.5;s.save(),s.globalAlpha=w,s.fillStyle=n.colors.cursor,s.fillRect(y,M-this.fontSize,2,this.fontSize),s.restore()}o+=a.length}),s.restore()}}const d=t=>{if(n.terminalSpeed===0)return;const s=t.canvas.width<768,o=s?20:50,a=s?t.canvas.height-250:50,A=s?280:400,M=s?150:200,p=14,b=18;t.save(),t.fillStyle=n.colors.background+"E6",t.fillRect(o,a,A,M),t.strokeStyle=n.colors.terminal,t.lineWidth=2,t.strokeRect(o,a,A,M),t.fillStyle=n.colors.terminal+"40",t.fillRect(o,a,A,25),["#FF5F56","#FFBD2E","#27CA3F"].forEach((m,S)=>{t.fillStyle=m,t.beginPath(),t.arc(o+15+S*20,a+12,6,0,Math.PI*2),t.fill()}),t.font=`${p}px 'Courier New', monospace`,t.fillStyle=n.colors.terminal;const y=Date.now(),w=Math.floor(y/3e3)%n.terminalCommands.length,F=n.terminalCommands[w],R=y%3e3/3e3,P=Math.floor(F.length*R),E=F.substring(0,P);if(t.fillText(E,o+10,a+50),R<1){const m=o+10+t.measureText(E).width,S=Math.sin(Date.now()*.008)*.5+.5;t.save(),t.globalAlpha=S,t.fillStyle=n.colors.cursor,t.fillRect(m,a+50-p,2,p),t.restore()}for(let m=1;m<=3;m++){const S=(w-m+n.terminalCommands.length)%n.terminalCommands.length,$=n.terminalCommands[S];t.save(),t.globalAlpha=1-m*.25,t.fillText($,o+10,a+50+m*b),t.restore()}t.restore()},f=t=>{r.current=[];for(let s=0;s<n.snippetCount;s++)r.current.push(new v(t))},k=()=>{const t=l.current;if(!t)return;const s=t.getContext("2d");C.registerCanvasContext(s),s.clearRect(0,0,t.width,t.height),d(s),r.current.forEach(o=>{o.update(),o.draw(s)})};return c.useEffect(()=>{const t=l.current;if(!t)return;const s=()=>{const o=t.getBoundingClientRect();t.width=o.width*(e?.pixelRatio||1),t.height=o.height*(e?.pixelRatio||1),t.getContext("2d").scale(e?.pixelRatio||1,e?.pixelRatio||1),f(t)};return s(),C.registerEventListener(window,"resize",s),(n.codeSpeed>0||n.terminalSpeed>0)&&u(k),()=>{g()}},[n,e,u,g]),h?.staticFallback?T.jsx("div",{className:"absolute inset-0 opacity-10",style:{background:`linear-gradient(135deg, ${n.colors.primary} 0%, ${n.colors.secondary} 50%, ${n.colors.accent} 100%)`}}):T.jsx("canvas",{ref:l,className:"absolute inset-0 w-full h-full pointer-events-none",style:{background:"transparent",mixBlendMode:"multiply",zIndex:-1},"aria-hidden":"true"})},j=z.memo(I);export{j as default};
